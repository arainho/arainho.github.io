<h1 id="update-openssh-client-to-version-71p2-1">Update OpenSSH Client to version 7.1p2-1</h1>

<p>Do to bugs CVE-2016-0777, CVE-2016-0778 with need to upgrade our OpenSSH Client on all machines to version 7.1p2-1,
or add the line “UseRoaming no” to OpenSSH Client config files. you can check details here <a href="http://www.cyberciti.biz/faq/howto-openssh-client-security-update-cve-0216-0777-cve-0216-0778/">cyberciti.biz</a> or <a href="https://www.digitalocean.com/community/questions/openssh-client-bug-cve-2016-0777-and-cve-2016-0778">digitalocean</a></p>

<h3 id="on-linux-and-freebsd">1. On Linux and FreeBSD</h3>
<p>Run this command to add the new line to your config:</p>

<pre><code>~# echo 'UseRoaming no' | sudo tee -a /etc/ssh/ssh_config
</code></pre>

<h3 id="on-mac-osx">2. On Mac OSX</h3>
<p>Run this command to add the new line to your config:</p>

<pre><code>~# echo "UseRoaming no" &gt;&gt; ~/.ssh/config
</code></pre>

<h3 id="to-upgrade-via-packages-on-arch-linux">3. To upgrade via packages on Arch Linux</h3>
<p>With pacman upgrade OpenSSH Client to desired version “7.1p2-1”</p>

<pre><code>~# pacman -Sy openssh
</code></pre>

<h3 id="to-upgrade-via-packages-on-debian--ubuntu-hosts">4. To upgrade via packages on Debian / Ubuntu hosts</h3>
<p>With apt-get upgrade OpenSSH Client to desired version “7.1p2-1”</p>

<pre><code>~# apt-get clean &amp;&amp; apt-get update &amp;&amp; apt-get install --reinstall -y openssh-client openssh-server
</code></pre>

<h3 id="some-old-debian-hosts-has-this-issue">4.1 Some Old Debian hosts has this issue</h3>

<pre><code>~# apt-get install grep openssh-client openssh-server

    Reading package lists... Done
    Building dependency tree       
    Reading state information... Done
    
    openssh-client is already the newest version.
    openssh-client set to manually installed.
    You might want to run 'apt-get -f install' to correct these:
    The following packages have unmet dependencies:
    openssh-server : Depends: openssh-client (= 1:6.0p1-4+deb7u2)
    
    E: Unmet dependencies. Try 'apt-get -f install' with no packages (or specify a solution).
</code></pre>

<h3 id="fix-debconf-first">4.2 Fix debconf first</h3>
<p>Fix debconf installation first, in my case debconf version is 1.5.49</p>

<pre><code>~# DEBCONF_VERSION=$(dpkg -l | grep " debconf " | awk '{print $3}')
~# wget http://ftp.us.debian.org/debian/pool/main/d/debconf/debconf_"${DEBCONF_VERSION}"_all.deb
~# dpkg -i debconf_"${DEBCONF_VERSION}"_all.deb

~# apt-get install grep openssh-client openssh-server
~# dpkg -l | grep openssh

    ii  openssh-client                       1:6.0p1-4+deb7u3                  amd64        secure shell (SSH) client, for secure access to remote machines
    
    ii  openssh-server                       1:6.0p1-4+deb7u3                  amd64        secure shell (SSH) server, for secure access from remote machines
</code></pre>

<h3 id="or-in-last-case-try-a-manual-install">4.3 Or in last case try a manual install</h3>
<p>Try manually installing OpenSSH client with dpkg</p>

<pre><code>~# dpkg -i /var/cache/apt/archives/openssh-client*.deb
</code></pre>

<h3 id="upgrade-openssh-client-via-ansible">5. Upgrade OpenSSH Client via Ansible</h3>
<p>Create a playbook named openssh.yml and run ansible-playbook to update Package on all Debian and Ubuntu nodes</p>

<pre><code>~# cat openssh.yml

    - hosts: all
    gather_facts: yes
    
    tasks:
        - name: Update OpenSSH (Debian+Ubuntu)
        apt: name=
            state=latest
            update_cache=yes
        with_items:
            - openssh-client
            - openssh-server
            - openssh-blacklist
            - openssh-blacklist-extra
            - ncurses-term
            
    post_tasks:
        - name: Check Restart
        command: checkrestart


~# ansible-playbook -i ansible_hosts openssh.yml
</code></pre>

